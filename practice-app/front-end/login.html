<html>
<head>
    <title> Login_page </title>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <meta name="google-signin-client_id" content="510505564353-nlhputgs749pijf4cbbs2un19ucl11ue.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/client:platform.js?onload=startApp"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>

<div id="login-box">
    <div class="left-box">
        <h1> Log in</h1>

        <form name="login" >
            Username<input type="text" id="userid"/>
            Password<input type="password" id ="password" />
            <button type="button" id="submitBtn">Login</button>
        </form>

        <h3> Isn't a member?</h3>
        <input type="button" onclick="location.href='/signup';" name="sign_up-button" value="Sign Up"/>


    </div>

    <div class="right-box">
    <div class="g-signin2" data-onsuccess="onSignIn"></div>
</div>

    <script>

        $(document).ready(function(){
            $("#submitBtn").click(function(){
                $.post("/login",
                    {
                        username: $("#userid").val(),
                        password: $("#password").val()
                    },
                    function (data, status) {
                        if(JSON.parse(data).success) {
                            window.location.href = "/main"
                        } else {
                            alert("Data: " + data + "\nStatus: " + status);
                        }
                    });
                $("#login").submit(); // Submit the form

            });

        });

    </script>

    <script>
        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
            console.log('Name: ' + profile.getName());
            console.log('Image URL: ' + profile.getImageUrl());
            console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
            var id_token = googleUser.getAuthResponse().id_token;
            window.location.href='https://github.com/bounswe/bounswe2019group1';
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://ourserver.com/tokensignin');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function() {
                console.log('Signed in as: ' + xhr.responseText);
            };
            xhr.send('idtoken=' + id_token);
        }
    </script>

</body>
</html>
